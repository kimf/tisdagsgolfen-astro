---
import db from 'src/db';
import Button from '../ui/button.astro';
const userId = await Astro.session?.get('userId');
const player = userId
  ? await db.query.profiles.findFirst({
      where: (p, { eq }) => eq(p.id, Number(userId))
    })
  : undefined;

const sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));
await sleep(1000);
---

{
  !userId && (
    <Button size="sm">
      <a href="/login">LOGGA IN</a>
    </Button>
  )
}

{
  userId && (
    <div class="inline-flex gap-1 justify-center items-center">
      <Button size="sm" intent="link" muted>
        <a href="/logout">LOGGA UT</a>
      </Button>
      <Button size="icon" intent="link" class="size-8">
        {player?.avatarUrl === '1' ? (
          <img src={`/images/avatars/${player.id}.png`} />
        ) : (
          <img src="/images/avatars/default.png" />
        )}
      </Button>
    </div>
  )
}
