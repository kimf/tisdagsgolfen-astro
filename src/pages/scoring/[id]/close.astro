---
import { closeScoringSession } from 'src/db/mutations/closeScoringSession';

const { id } = Astro.params;
const userId = await Astro.session?.get('userId');

if (!userId) throw new Error('Logga in för att stänga runda');
if (!id) throw new Error('Id saknas för runda');

if (Astro.request.method === 'POST' && userId === '2') {
  await closeScoringSession(Number(id));
  return new Response(null, {
    status: 204,
    statusText: 'No Content',
    headers: {
      'HX-Redirect': '/'
    }
  });
} else {
  return new Response(null, {
    status: 204,
    statusText: 'No Content',
    headers: {
      'HX-Redirect': `/scoring/${id}/leaderboard`
    }
  });
}
---
